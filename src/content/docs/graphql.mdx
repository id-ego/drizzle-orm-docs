import Tab from '@mdx/Tab.astro';
import Tabs from '@mdx/Tabs.astro';
import Callout from '@mdx/Callout.astro';
import CodeTab from '@mdx/CodeTab.astro';
import CodeTabs from '@mdx/CodeTabs.astro';
import Npm from '@mdx/Npm.astro';

# drizzle-graphql

Drizzle ìŠ¤í‚¤ë§ˆì—ì„œ í•œ ì¤„ë¡œ GraphQL ì„œë²„ë¥¼ ìƒì„±í•˜ê³ , ì»¤ìŠ¤í…€ ì¿¼ë¦¬ì™€ ë®¤í…Œì´ì…˜ìœ¼ë¡œ ì‰½ê²Œ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë¹ ë¥¸ ì‹œì‘

`drizzle-orm` ë²„ì „ì´ ìµœì†Œ `0.30.9` ì´ìƒì¸ì§€ í™•ì¸í•˜ê³ , í•„ìš”í•˜ë©´ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”:
<Npm>drizzle-orm@latest</Npm>

### Apollo Server

<Npm>drizzle-graphql @apollo/server graphql</Npm>

<CodeTabs items={['server.ts', 'schema.ts']}>
<CodeTab>
```ts copy {1, 10}
import { buildSchema } from 'drizzle-graphql';
import { drizzle } from 'drizzle-orm/...';
import client from './db';
import { ApolloServer } from '@apollo/server';
import { startStandaloneServer } from '@apollo/server/standalone';

import * as dbSchema from './schema';

const db = drizzle({ client, schema: dbSchema });

const { schema } = buildSchema(db);

const server = new ApolloServer({ schema });
const { url } = await startStandaloneServer(server);

console.log(`ğŸš€ Server ready at ${url}`);
```
</CodeTab>
<CodeTab>
```typescript copy
import { integer, serial, text, pgTable } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name').notNull(),
});

export const usersRelations = relations(users, ({ many }) => ({
  posts: many(posts),
}));

export const posts = pgTable('posts', {
  id: serial('id').primaryKey(),
  content: text('content').notNull(),
  authorId: integer('author_id').notNull(),
});

export const postsRelations = relations(posts, ({ one }) => ({
  author: one(users, { fields: [posts.authorId], references: [users.id] }),
}));
```
</CodeTab>
</CodeTabs>

### GraphQL Yoga

<Npm>drizzle-graphql graphql-yoga graphql</Npm>

<CodeTabs items={['server.ts', 'schema.ts']}>
<CodeTab>
```ts copy {1, 10}
import { buildSchema } from 'drizzle-graphql';
import { drizzle } from 'drizzle-orm/...';
import { createYoga } from 'graphql-yoga';
import { createServer } from 'node:http';

import * as dbSchema from './schema';

const db = drizzle({ schema: dbSchema });

const { schema } = buildSchema(db);

const yoga = createYoga({ schema });
const server = createServer(yoga);

server.listen(4000, () => {
  console.info('Server is running on http://localhost:4000/graphql');
});
```
</CodeTab>
<CodeTab>
```typescript copy
import { integer, serial, text, pgTable } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name').notNull(),
});

export const usersRelations = relations(users, ({ many }) => ({
  posts: many(posts),
}));

export const posts = pgTable('posts', {
  id: serial('id').primaryKey(),
  content: text('content').notNull(),
  authorId: integer('author_id').notNull(),
});

export const postsRelations = relations(posts, ({ one }) => ({
  author: one(users, { fields: [posts.authorId], references: [users.id] }),
}));
```
</CodeTab>
</CodeTabs>

## ìŠ¤í‚¤ë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§•

<Callout type='info' emoji='â„¹ï¸'>
`buildSchema()`ëŠ” í‘œì¤€ `graphql` SDKë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í‚¤ë§ˆì™€ íƒ€ì…ì„ ìƒì„±í•˜ë¯€ë¡œ, ì´ë¥¼ ì§€ì›í•˜ëŠ” ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í˜¸í™˜ë©ë‹ˆë‹¤.
</Callout>

ìŠ¤í‚¤ë§ˆë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ë ¤ë©´ `entities` ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ìŠ¤í‚¤ë§ˆë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<CodeTabs items={['server.ts', 'schema.ts']}>
<CodeTab>
```ts {1, 11}
import { buildSchema } from 'drizzle-graphql';
import { drizzle } from 'drizzle-orm/...';
import { GraphQLList, GraphQLNonNull, GraphQLObjectType, GraphQLSchema } from 'graphql';
import { createYoga } from 'graphql-yoga';
import { createServer } from 'node:http';

import * as dbSchema from './schema';

const db = drizzle({ schema: dbSchema });

const { entities } = buildSchema(db);

// ì›í•˜ëŠ” ì¿¼ë¦¬ ë˜ëŠ” ë®¤í…Œì´ì…˜ì˜ ë¶€ë¶„ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
const schema = new GraphQLSchema({
  query: new GraphQLObjectType({
    name: 'Query',
    fields: {
      // ìƒì„±ëœ ëª¨ë“  ì¿¼ë¦¬ ì¤‘ ì›í•˜ëŠ” ì¿¼ë¦¬ë§Œ ì„ íƒ
      users: entities.queries.users,
      customer: entities.queries.customersSingle,

      // ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ìƒì„±
      customUsers: {
        // ì›ë³¸ ìŠ¤í‚¤ë§ˆì˜ íƒ€ì…ì„ ì¬ì‚¬ìš©í•˜ê³  ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
        type: new GraphQLList(new GraphQLNonNull(entities.types.UsersItem)),
        args: {
          // ì…ë ¥ê°’ë„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
          where: {
            type: entities.inputs.UsersFilters
          },
        },
        resolve: async (source, args, context, info) => {
          // ì»¤ìŠ¤í…€ ë¡œì§ì„ ì—¬ê¸°ì— ì‘ì„±í•©ë‹ˆë‹¤...
          const result = await db.select(schema.users).where()...

          return result;
        },
      },
    },
  }),
  // ë®¤í…Œì´ì…˜ì—ë„ ë™ì¼í•œ ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤
  mutation: new GraphQLObjectType({
    name: 'Mutation',
    fields: entities.mutations,
  }),
  // ìŠ¤í‚¤ë§ˆ ë‚´ì—ì„œ íƒ€ì…ì´ í•„ìš”í•œ ê²½ìš°
  types: [...Object.values(entities.types), ...Object.values(entities.inputs)],
});

const yoga = createYoga({
  schema,
});

const server = createServer(yoga);

server.listen(4000, () => {
  console.info('Server is running on http://localhost:4000/graphql');
})
```
</CodeTab>
<CodeTab>
```typescript copy
import { integer, serial, text, pgTable } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name').notNull(),
});

export const usersRelations = relations(users, ({ many }) => ({
  posts: many(posts),
}));

export const posts = pgTable('posts', {
  id: serial('id').primaryKey(),
  content: text('content').notNull(),
  authorId: integer('author_id').notNull(),
});

export const postsRelations = relations(posts, ({ one }) => ({
  author: one(users, { fields: [posts.authorId], references: [users.id] }),
}));
```
</CodeTab>
</CodeTabs>
