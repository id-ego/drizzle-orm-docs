import Npm from "@mdx/Npm.astro";
import Callout from '@mdx/Callout.astro';
import AnchorCards from '@mdx/AnchorCards.astro';
import Steps from '@mdx/Steps.astro';
import WhatsNextPostgres from "@mdx/WhatsNextPostgres.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import CodeTabs from "@mdx/CodeTabs.astro";

# Drizzle \<\> Cloudflare D1

<Prerequisites>
- Drizzle과 함께 사용하는 데이터베이스 [연결 기초](/docs/connect-overview)
- D1 Database - [공식 문서](https://developers.cloudflare.com/d1/)
- D1 driver - [공식 문서](https://developers.cloudflare.com/d1/build-with-d1/d1-client-api/)
</Prerequisites>

**[공식 문서](https://developers.cloudflare.com/d1/)**에 따르면,
D1은 Cloudflare의 첫 번째 쿼리 가능한 관계형 데이터베이스입니다.

Drizzle ORM은 Cloudflare D1 데이터베이스와 Cloudflare Workers 환경을 완벽하게 지원합니다.
SQL 방언과 방언별 드라이버 및 문법을 지원하며, 가장 널리 사용되는
SQLite 스타일의 `all`, `get`, `values`, `run` 쿼리 메서드 문법을 제공합니다.

Cloudflare D1용 프로젝트 설정 방법은 **[공식 문서](https://developers.cloudflare.com/d1/)**를 참조하세요.

#### Step 1 - 패키지 설치
<Npm>
drizzle-orm
-D drizzle-kit
</Npm>

#### Step 2 - 드라이버 초기화 및 쿼리 실행

D1 데이터베이스를 위해서는 `wrangler.json` 또는 `wrangler.toml` 파일이 필요하며, 다음과 같은 형태를 가집니다:
<CodeTabs items={["wrangler.json", "wrangler.toml"]}>
```json
{
    "name": "YOUR_PROJECT_NAME",
    "main": "src/index.ts",
    "compatibility_date": "2024-09-26",
    "compatibility_flags": [
        "nodejs_compat"
    ],
    "d1_databases": [
        {
            "binding": "BINDING_NAME",
            "database_name": "YOUR_DB_NAME",
            "database_id": "YOUR_DB_ID",
            "migrations_dir": "drizzle/migrations"
        }
    ]
}
```
```toml
name = "YOUR_PROJECT_NAME"
main = "src/index.ts"
compatibility_date = "2022-11-07"
node_compat = true

[[ d1_databases ]]
binding = "BINDING_NAME"
database_name = "YOUR_DB_NAME"
database_id = "YOUR_DB_ID"
migrations_dir = "drizzle/migrations"
```
</CodeTabs>

첫 번째 D1 쿼리를 작성합니다:
```typescript copy
import { drizzle } from 'drizzle-orm/d1';

export interface Env {
  <BINDING_NAME>: D1Database;
}

export default {
  async fetch(request: Request, env: Env) {
    const db = drizzle(env.<BINDING_NAME>);
    const result = await db.select().from(users).all()
    return Response.json(result);
  },
};
```

#### 다음 단계

<WhatsNextPostgres/>