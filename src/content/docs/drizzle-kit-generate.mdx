import CodeTab from "@mdx/CodeTab.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import Section from "@mdx/Section.astro";
import Tab from "@mdx/Tab.astro";
import Tabs from "@mdx/Tabs.astro";
import Callout from "@mdx/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro"
import Npx from "@mdx/Npx.astro";
import SchemaFilePaths from "@mdx/SchemaFilePaths.mdx"
import Dialects from "@mdx/Dialects.mdx"

# `drizzle-kit generate`

<Prerequisites>
- Drizzle ë° `drizzle-kit` ì‹œì‘í•˜ê¸° - [ì—¬ê¸°ì—ì„œ ì½ê¸°](/docs/get-started)
- Drizzle ìŠ¤í‚¤ë§ˆ ê¸°ë³¸ - [ì—¬ê¸°ì—ì„œ ì½ê¸°](/docs/sql-schema-declaration)
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê¸°ë³¸ - [ì—¬ê¸°ì—ì„œ ì½ê¸°](/docs/connect-overview)
- Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ë³¸ - [ì—¬ê¸°ì—ì„œ ì½ê¸°](/docs/migrations)
- Drizzle Kit [ê°œìš”](/docs/kit-overview) ë° [ì„¤ì • íŒŒì¼](/docs/drizzle-config-file)
</Prerequisites>


<br/>

`drizzle-kit generate`ëŠ” Drizzle ìŠ¤í‚¤ë§ˆ ì„ ì–¸ ì‹œì  ë˜ëŠ” ì´í›„ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤.
<Callout collapsed="ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?">
Drizzle Kit `generate` ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ì€ ì¼ë ¨ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
1. Drizzle ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ì½ê³  ìŠ¤í‚¤ë§ˆì˜ JSON ìŠ¤ëƒ…ìƒ·ì„ ìƒì„±í•©ë‹ˆë‹¤
2. ì´ì „ ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”ë¥¼ ì½ê³  í˜„ì¬ JSON ìŠ¤ëƒ…ìƒ·ì„ ê°€ì¥ ìµœê·¼ ìŠ¤ëƒ…ìƒ·ê³¼ ë¹„êµí•©ë‹ˆë‹¤
3. JSON ì°¨ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤
4. í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”ì— `migration.sql`ê³¼ `snapshot.json`ì„ ì €ì¥í•©ë‹ˆë‹¤

<Section>
```typescript filename="src/schema.ts"
import * as p from "./drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
  email: p.text().unique(), 
};
```
```                                  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ $ drizzle-kit generate â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                           
  â”” 1. read previous migration folders
    2. find diff between current and previous schema
    3. prompt developer for renames if necessary
  â”Œ 4. generate SQL migration and persist to file
  â”‚    â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
  â”‚      ğŸ“‚ drizzle       
  â”‚      â”” ğŸ“‚ 20242409125510_premium_mister_fear
  â”‚        â”œ ğŸ“œ migration.sql
  â”‚        â”” ğŸ“œ snapshot.json
  v
```
```sql
-- drizzle/20242409125510_premium_mister_fear/migration.sql

CREATE TABLE "users" (
 "id" SERIAL PRIMARY KEY,
 "name" TEXT,
 "email" TEXT UNIQUE
);
```
</Section>
</Callout>

[ì½”ë“œ ìš°ì„ ](/docs/migrations) ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê´€ë¦¬í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
ìƒì„±ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ [`drizzle-kit migrate`](/docs/drizzle-kit-migrate)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, drizzle-ormì˜ `migrate()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜,
[bytebase](https://www.bytebase.com/)ì™€ ê°™ì€ ì™¸ë¶€ ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ì‹¤í–‰í•˜ì—¬ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`drizzle-kit generate` ëª…ë ¹ì€ `dialect`ì™€ `schema` ê²½ë¡œ ì˜µì…˜ì„ ëª¨ë‘ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.
[drizzle.config.ts](/docs/drizzle-config-file) ì„¤ì • íŒŒì¼ì„ í†µí•´ ì œê³µí•˜ê±°ë‚˜ CLI ì˜µì…˜ìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
<CodeTabs items={["ì„¤ì • íŒŒì¼ ì‚¬ìš©", "CLI ì˜µì…˜ ì‚¬ìš©"]}>
<Section>
```ts
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
});
```
```shell
npx drizzle-kit generate
```
</Section>

```shell
npx drizzle-kit generate --dialect=postgresql --schema=./src/schema.ts
```
</CodeTabs>

### ìŠ¤í‚¤ë§ˆ íŒŒì¼ ê²½ë¡œ
í”„ë¡œì íŠ¸ ì „ì²´ì— ë‹¨ì¼ `schema.ts` íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆê³ , ì›í•˜ëŠ” ë§Œí¼ ì—¬ëŸ¬ ìŠ¤í‚¤ë§ˆ íŒŒì¼ë¡œ ë¶„ì‚°ì‹œí‚¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
Drizzle Kitì€ `schema` ì„¤ì • ì˜µì…˜ì„ í†µí•´ [glob](https://www.digitalocean.com/community/tools/glob?comments=true&glob=/**/*.js&matches=false&tests=//%20This%20will%20match%20as%20it%20ends%20with%20'.js'&tests=/hello/world.js&tests=//%20This%20won't%20match!&tests=/test/some/globs) í˜•ì‹ì˜ ê²½ë¡œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<SchemaFilePaths/>


### ì»¤ìŠ¤í…€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ëª…
`--name` CLI ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ëª…ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
```shell
npx drizzle-kit generate --name=init
```
```plaintext {4}
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”‚ â”” ğŸ“‚ 20242409125510_init
 â”‚   â”œ ğŸ“œ snapshot.json
 â”‚   â”” ğŸ“œ migration.sql
 â”œ ğŸ“‚ src
 â”” â€¦
```

### í”„ë¡œì íŠ¸ ë‚´ ì—¬ëŸ¬ ì„¤ì • íŒŒì¼
í”„ë¡œì íŠ¸ì— ì—¬ëŸ¬ ê°œì˜ ì„¤ì • íŒŒì¼ì„ ë‘˜ ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½(ê°œë°œ/í”„ë¡œë•ì…˜)ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë™ì¼í•œ í”„ë¡œì íŠ¸ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•  ë•Œ ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤:
<Npx>
  drizzle-kit generate --config=drizzle-dev.config.ts
  drizzle-kit generate --config=drizzle-prod.config.ts
</Npx>
```plaintext {5-6}
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle-dev.config.ts
 â”œ ğŸ“œ drizzle-prod.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```

### ì»¤ìŠ¤í…€ ë§ˆì´ê·¸ë ˆì´ì…˜
Drizzle Kitì´ í˜„ì¬ ì§€ì›í•˜ì§€ ì•ŠëŠ” DDL ë³€ê²½ì´ë‚˜ ë°ì´í„° ì‹œë”©ì„ ìœ„í•´ ë¹ˆ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì»¤ìŠ¤í…€ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì»¤ìŠ¤í…€ ë§ˆì´ê·¸ë ˆì´ì…˜ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”](/docs/kit-custom-migrations)

```shell
drizzle-kit generate --custom --name=seed-users
```
<Section>
```plaintext {5}
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ 20242409125510_init
 â”‚ â”” ğŸ“‚ 20242409125510_seed-users
 â”œ ğŸ“‚ src
 â”” â€¦
```
```sql
-- ./drizzle/20242409125510_seed/migration.sql

INSERT INTO "users" ("name") VALUES('Dan');
INSERT INTO "users" ("name") VALUES('Andrew');
INSERT INTO "users" ("name") VALUES('Dandrew');
```
</Section>

### ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì •ì˜ ì „ì²´ ëª©ë¡
`drizzle-kit generate`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” CLI ì „ìš© ì˜µì…˜ ëª©ë¡ì…ë‹ˆë‹¤

<rem025/>

|               |                                                      |
| :--------     | :--------------------------------------------------- |
| `custom`      | ì»¤ìŠ¤í…€ ë§ˆì´ê·¸ë ˆì´ì…˜ìš© ë¹ˆ SQL íŒŒì¼ ìƒì„±              |
| `name`        | ì»¤ìŠ¤í…€ ì´ë¦„ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±                  |

<rem025/>

<Npx>
drizzle-kit generate --name=init
drizzle-kit generate --name=seed_users --custom
</Npx>

<br/>
<hr/>
<br/>
[drizzle.config.ts](/docs/drizzle-config-file) íŒŒì¼ì„ í†µí•´ `drizzle-kit`ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ì§€ë§Œ,
í•„ìš”í•œ ê²½ìš° (ì˜ˆ: CI/CD íŒŒì´í”„ë¼ì¸) CLIë¥¼ í†µí•´ ëª¨ë“  ì„¤ì • ì˜µì…˜ì„ ì§ì ‘ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

|               |            |                                                                            |
| :------------ | :-------   | :----------------------------------------------------------------------    |
| `dialect`     | `í•„ìˆ˜` | ë°ì´í„°ë² ì´ìŠ¤ dialect, <Dialects/> ì¤‘ í•˜ë‚˜                                       |
| `schema`      | `í•„ìˆ˜` | TypeScript ìŠ¤í‚¤ë§ˆ íŒŒì¼ ë˜ëŠ” ì—¬ëŸ¬ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì´ ìˆëŠ” í´ë” ê²½ë¡œ  |
| `out`         |            | ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶œë ¥ í´ë”, ê¸°ë³¸ê°’ `./drizzle`                           |
| `config`      |            | ì„¤ì • íŒŒì¼ ê²½ë¡œ, ê¸°ë³¸ê°’ `drizzle.config.ts`                    |
| `breakpoints` |            | SQL ë¬¸ ì¤‘ë‹¨ì , ê¸°ë³¸ê°’ `true`                              |


### í™•ì¥ ì˜ˆì œ
`./src/schema.ts`ì— ìœ„ì¹˜í•œ Drizzle ìŠ¤í‚¤ë§ˆë¥¼ ì‚¬ìš©í•˜ê³ , ê¸°ë³¸ `./drizzle` ëŒ€ì‹  `./migrations` í´ë”ë¥¼ ì‚¬ìš©í•˜ì—¬
`0001_seed-users.sql`ì´ë¼ëŠ” ì»¤ìŠ¤í…€ PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

ë˜í•œ `configs` í´ë”ì— drizzle ì„¤ì • íŒŒì¼ì„ ë°°ì¹˜í•©ë‹ˆë‹¤.

ì„¤ì • íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:

```plaintext {4}
ğŸ“¦ <project root>
 â”œ ğŸ“‚ migrations
 â”œ ğŸ“‚ configs
 â”‚ â”” ğŸ“œ drizzle.config.ts
 â”œ ğŸ“‚ src
 â”” â€¦
```
```ts filename='drizzle.config.ts'
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  out: "./migrations",
});
```

ì´ì œ ì‹¤í–‰í•©ë‹ˆë‹¤
```shell
npx drizzle-kit generate --config=./configs/drizzle.config.ts --name=seed-users --custom
```
ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
<Section>
```plaintext {6}
ğŸ“¦ <project root>
 â”œ â€¦
 â”œ ğŸ“‚ migrations
 â”‚ â”œ ğŸ“‚ 20242409125510_init
 â”‚ â”” ğŸ“‚ 20242409125510_seed-users
 â”” â€¦
```
```sql
-- ./drizzle/20242409125510_seed-users/migration.sql

INSERT INTO "users" ("name") VALUES('Dan');
INSERT INTO "users" ("name") VALUES('Andrew');
INSERT INTO "users" ("name") VALUES('Dandrew');
```
</Section>
