import CodeTab from "@mdx/CodeTab.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import Section from "@mdx/Section.astro";
import Tab from "@mdx/Tab.astro";
import Tabs from "@mdx/Tabs.astro";
import Callout from "@mdx/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import Npx from "@mdx/Npx.astro";

# `drizzle-kit migrate`
<Prerequisites>
- Drizzle ë° `drizzle-kit` ì‹œì‘í•˜ê¸° - [ë°”ë¡œê°€ê¸°](/docs/get-started)
- Drizzle ìŠ¤í‚¤ë§ˆ ê¸°ì´ˆ - [ë°”ë¡œê°€ê¸°](/docs/sql-schema-declaration)
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê¸°ì´ˆ - [ë°”ë¡œê°€ê¸°](/docs/connect-overview)
- Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ì´ˆ - [ë°”ë¡œê°€ê¸°](/docs/migrations)
- Drizzle Kit [ê°œìš”](/docs/kit-overview) ë° [ì„¤ì • íŒŒì¼](/docs/drizzle-config-file)
- `drizzle-kit generate` ëª…ë ¹ì–´ - [ë°”ë¡œê°€ê¸°](/docs/drizzle-kit-generate)
</Prerequisites>
<br/>


`drizzle-kit migrate` ëª…ë ¹ì–´ëŠ” [`drizzle-kit generate`](/docs/drizzle-kit-generate)ë¡œ ìƒì„±ëœ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©í•©ë‹ˆë‹¤.
ì´ ëª…ë ¹ì–´ëŠ” Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê´€ë¦¬í•˜ëŠ” [ì½”ë“œ ìš°ì„  ì ‘ê·¼ ë°©ì‹(ì˜µì…˜ 3)](/docs/migrations)ì„ ì§€ì›í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. 

<Callout collapsed="ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?">
Drizzle Kitì˜ `migrate` ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¼ë ¨ì˜ ê³¼ì •ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:
1. ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë”ë¥¼ íƒìƒ‰í•˜ì—¬ ëª¨ë“  `.sql` ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì„ ì½ìŠµë‹ˆë‹¤
2. ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ì—¬ Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ í…Œì´ë¸”ì—ì„œ í•­ëª©ì„ ê°€ì ¸ì˜µë‹ˆë‹¤
3. ì´ì „ì— ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰í•  ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê²°ì •í•©ë‹ˆë‹¤
4. SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ê³  ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ Drizzle ë§ˆì´ê·¸ë ˆì´ì…˜ í…Œì´ë¸”ì— ê¸°ë¡í•©ë‹ˆë‹¤

<Section>
```plaintext
  â”œ ğŸ“‚ drizzle       
  â”‚ â”œ ğŸ“‚ 20242409125510_premium_mister_fear
  â”‚ â”” ğŸ“‚ 20242409135510_delicate_professor_xavie
  â”” â€¦
```
```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ $ drizzle-kit migrate â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         
  â”” 1. reads migration.sql files in migrations folder       â”‚                          â”‚
    2. fetch migration history from database -------------> â”‚                          â”‚
  â”Œ 3. pick previously unapplied migrations <-------------- â”‚         DATABASE         â”‚
  â”” 4. apply new migration to the database ---------------> â”‚                          â”‚
                                                            â”‚                          â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[âœ“] done!        
```
</Section>
</Callout>

`drizzle-kit migrate` ëª…ë ¹ì–´ëŠ” `dialect`ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìê²© ì¦ëª…ì´ í•„ìš”í•˜ë©°,
[drizzle.config.ts](/docs/drizzle-config-file) ì„¤ì • íŒŒì¼ ë˜ëŠ” CLI ì˜µì…˜ì„ í†µí•´ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

<CodeTabs items={["ì„¤ì • íŒŒì¼ ì‚¬ìš©", "CLI ì˜µì…˜ ì‚¬ìš©"]}>
<Section>
```ts {5,8}
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
});
```
```shell
npx drizzle-kit migrate
```
</Section>
```shell
npx drizzle-kit migrate --dialect=postgresql --url=postgresql://user:password@host:port/dbname
```
</CodeTabs>

### ë°ì´í„°ë² ì´ìŠ¤ì˜ ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸
ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ Drizzle Kitì€ ì„±ê³µì ìœ¼ë¡œ ì ìš©ëœ ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ë¡ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.
ì´ëŸ¬í•œ ê¸°ë¡ì€ `__drizzle_migrations`ë¼ëŠ” ì´ë¦„ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œê·¸ í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤.

Drizzle ì„¤ì • íŒŒì¼ì„ í†µí•´ í•´ë‹¹ í…Œì´ë¸”ì˜ **table**ê³¼ **schema**(PostgreSQLë§Œ í•´ë‹¹)ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```ts filename="drizzle.config.ts" {8-9}
export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
  migrations: {
    table: 'my-migrations-table', // `__drizzle_migrations` by default
    schema: 'public', // used in PostgreSQL only, `drizzle` by default
  },
});
```

### í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì— ì—¬ëŸ¬ ì„¤ì • íŒŒì¼ ì‚¬ìš©
í”„ë¡œì íŠ¸ì— ì—¬ëŸ¬ ê°œì˜ ì„¤ì • íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½(ê°œë°œ/ìš´ì˜ ë“±) ë˜ëŠ” ë™ì¼í•œ í”„ë¡œì íŠ¸ì— ì—¬ëŸ¬ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìˆì„ ë•Œ ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤:
<Npx>
  drizzle-kit migrate --config=drizzle-dev.config.ts
  drizzle-kit migrate --config=drizzle-prod.config.ts
</Npx>
```plaintext {5-6}
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle-dev.config.ts
 â”œ ğŸ“œ drizzle-prod.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```

### í™•ì¥ ì˜ˆì œ
`drizzle-kit generate` ë° `drizzle-kit migrate` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìƒì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤

```plaintext
ğŸ“¦ <project root>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”‚ â”œ ğŸ“œ schema.ts
 â”‚ â”” ğŸ“œ index.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”” â€¦
```
<CodeTabs items={["drizzle.config.ts", "src/schema.ts"]}>
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
  migrations: {
    table: 'journal', 
    schema: 'drizzle', 
  },
});
```
```ts 
import * as p from "drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
})
```
</CodeTabs>

ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤
```shell
npx drizzle-kit generate --name=init
```
ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ë©ë‹ˆë‹¤
<Section>
```plaintext {5}
ğŸ“¦ <project root>
 â”œ â€¦
 â”œ ğŸ“‚ migrations
 â”‚ â”œ ğŸ“‚ 20242409125510_init
 â”” â€¦
```
```sql
-- ./drizzle/0000_init.sql

CREATE TABLE "users"(
  id serial primary key,
  name text
)
```
</Section>

ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤
```shell
npx drizzle-kit migrate
```

SQL ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…
