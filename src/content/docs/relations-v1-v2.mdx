import Callout from '@mdx/Callout.astro';
import Prerequisites from "@mdx/Prerequisites.astro";
import Section from '@mdx/Section.astro';
import Npx from "@mdx/Npx.astro";
import Npm from "@mdx/Npm.astro";
import CodeTabs from '@mdx/CodeTabs.astro';
import CodeTab from '@mdx/CodeTab.astro';

# Relational Queries ë²„ì „ 2ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

<Callout type='error'>
ì´ í˜ì´ì§€ëŠ” drizzle ë²„ì „ `1.0.0-beta.1` ì´ìƒì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê°œë…ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
</Callout>

<Npm>
drizzle-orm@beta
drizzle-kit@beta -D
</Npm>

<br/>

<Prerequisites>
- **Drizzle Relations v1** - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/relations)
- **Relational Queries v1** - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/rqb)
- **drizzle-kit pull** - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/drizzle-kit-pull)
- **Relations ê¸°ì´ˆ** - [ì—¬ê¸°ì„œ ì½ê¸°](/docs/relations-schema-declaration)
</Prerequisites>

<Callout>
ì•„ë˜ëŠ” ëª©ì°¨ì…ë‹ˆë‹¤. í•­ëª©ì„ í´ë¦­í•˜ì—¬ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- [v1ì—ì„œ ë‹¬ë¼ì§„ ë™ì‘ ë°©ì‹](#what-was-changed-and-is-working-differently-from-v1)
- [v2ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥](2#what-is-new)
- [v1ì—ì„œ v2ë¡œ ê´€ê³„ ì •ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸°](#how-to-migrate-relations-schema-definition-from-v1-to-v2)
- [v1ì—ì„œ v2ë¡œ ì¿¼ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸°](#how-to-migrate-queries-from-v1-to-v2)
- [ë¶€ë¶„ ì—…ê·¸ë ˆì´ë“œ, ë˜ëŠ” ì—…ê·¸ë ˆì´ë“œ í›„ì—ë„ v1 ìœ ì§€í•˜ê¸°](#partial-upgrade-or-how-to-stay-on-rqb-v1-even-after-an-upgrade)
- [ë‚´ë¶€ ë³€ê²½ì‚¬í•­(import, ë‚´ë¶€ íƒ€ì… ë“±)](#internal-changes)
</Callout>

### API ë³€ê²½ì‚¬í•­
#### v1ì—ì„œ ë‹¬ë¼ì§„ ë™ì‘ ë°©ì‹

{/* ##### Drizzle Relations schema definition */}

ê°€ì¥ í° ì—…ë°ì´íŠ¸ ì¤‘ í•˜ë‚˜ëŠ” **Relations ìŠ¤í‚¤ë§ˆ ì •ì˜** ë¶€ë¶„ì…ë‹ˆë‹¤.

ì²« ë²ˆì§¸ ì°¨ì´ì ì€ ë” ì´ìƒ ê° í…Œì´ë¸”ì— ëŒ€í•œ `relations`ì„ ì„œë¡œ ë‹¤ë¥¸ ê°ì²´ì—ì„œ ê°œë³„ì ìœ¼ë¡œ ì§€ì •í•œ ë‹¤ìŒ
ìŠ¤í‚¤ë§ˆì™€ í•¨ê»˜ `drizzle()`ì— ëª¨ë‘ ì „ë‹¬í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. Relational Queries v2ì—ì„œëŠ” ì´ì œ
í•„ìš”í•œ ëª¨ë“  í…Œì´ë¸”ì˜ ê´€ê³„ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” ì „ìš© ì¥ì†Œê°€ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤.

ì½œë°±ì˜ `r` ë§¤ê°œë³€ìˆ˜ëŠ” ìŠ¤í‚¤ë§ˆì˜ ëª¨ë“  í…Œì´ë¸”ê³¼ `one`, `many`, `through`ì™€ ê°™ì€ í•¨ìˆ˜ë¥¼ í¬í•¨í•˜ì—¬
í¬ê´„ì ì¸ ìë™ ì™„ì„± ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ë³¸ì§ˆì ìœ¼ë¡œ ê´€ê³„ë¥¼ ì§€ì •í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ê²ƒì„ ì œê³µí•©ë‹ˆë‹¤.

```ts
// relations.ts
import * as schema from "./schema"
import { defineRelations } from "drizzle-orm"

export const relations = defineRelations(schema, (r) => ({
    ...
}));
```
```ts
// index.ts
import { relations } from "./relations"
import { drizzle } from "drizzle-orm/..."

const db = drizzle(process.env.DATABASE_URL, { relations })
```

##### ë¬´ì—‡ì´ ë‹¤ë¥¸ê°€ìš”?

<Callout collapsed="ìŠ¤í‚¤ë§ˆ ì •ì˜">
```ts copy {21-28}
import * as p from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

export const users = p.pgTable('users', {
	id: p.integer().primaryKey(),
	name: p.text(),
	invitedBy: p.integer('invited_by'),
});

export const posts = p.pgTable('posts', {
	id: p.integer().primaryKey(),
	content: p.text(),
	authorId: p.integer('author_id'),
});
```
</Callout>

**ëª¨ë“  ê´€ê³„ë¥¼ í•œ ê³³ì—ì„œ ì •ì˜**

<Callout title="âŒ v1">
```ts
import { relations } from "drizzle-orm/_relations";
import { users, posts } from './schema';

export const usersRelation = relations(users, ({ one, many }) => ({
  invitee: one(users, {
    fields: [users.invitedBy],
    references: [users.id],
  }),
  posts: many(posts),
}));

export const postsRelation = relations(posts, ({ one, many }) => ({
  author: one(users, {
    fields: [posts.authorId],
    references: [users.id],
  }),
}));
```
</Callout>

<Callout title='âœ… v2'>
```ts
import { defineRelations } from "drizzle-orm";
import * as schema from "./schema";

export const relations = defineRelations(schema, (r) => ({
  users: {
    invitee: r.one.users({
      from: r.users.invitedBy,
      to: r.users.id,
    }),
    posts: r.many.posts(),
  },
  posts: {
    author: r.one.users({
      from: r.posts.authorId,
      to: r.users.id,
    }),
  },
}));
```
</Callout>

ì—¬ì „íˆ ì—¬ëŸ¬ `parts`ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì›í•˜ëŠ” í¬ê¸°ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤

```ts
import { defineRelations, defineRelationsPart } from 'drizzle-orm';
import * as schema from "./schema";

export const relations = defineRelations(schema, (r) => ({
  users: {
    invitee: r.one.users({
      from: r.users.invitedBy,
      to: r.users.id,
    }),
    posts: r.many.posts(),
  }
}));

export const part = defineRelationsPart(schema, (r) => ({
  posts: {
    author: r.one.users({
      from: r.posts.authorId,
      to: r.users.id,
    }),
  }
}));
```

ê·¸ëŸ° ë‹¤ìŒ db ì¸ìŠ¤í„´ìŠ¤ì— ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

```ts
const db = drizzle(process.env.DB_URL, { relations: { ...relations, ...part } })
```

**`one` ì—†ì´ `many` ì •ì˜í•˜ê¸°**

v1ì—ì„œëŠ” ê´€ê³„ì˜ `many` ì¸¡ë©´ë§Œ ì›í•˜ëŠ” ê²½ìš°, ë°˜ëŒ€í¸ì—ì„œ `one` ì¸¡ë©´ì„ ì§€ì •í•´ì•¼ í–ˆìœ¼ë©°,
ì´ëŠ” ì¢‹ì§€ ì•Šì€ ê°œë°œì ê²½í—˜ì„ ì œê³µí–ˆìŠµë‹ˆë‹¤.

v2ì—ì„œëŠ” ì¶”ê°€ ë‹¨ê³„ ì—†ì´ `many` ì¸¡ë©´ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

<Callout title="âŒ v1">
```ts
import { relations } from "drizzle-orm/_relations";
import { users, posts } from './schema';

export const usersRelation = relations(users, ({ one, many }) => ({
  posts: many(posts),
}));

export const postsRelation = relations(posts, ({ one, many }) => ({
  author: one(users, {
    fields: [posts.authorId],
    references: [users.id],
  }),
}));
```
</Callout>

<Callout title='âœ… v2'>
```ts
import { defineRelations } from "drizzle-orm";
import * as schema from "./schema";

export const relations = defineRelations(schema, (r) => ({
  users: {
    posts: r.many.posts({
      from: r.users.id,
      to: r.posts.authorId,
    }),
  },
}));
```
</Callout>

**ìƒˆë¡œìš´ `optional` ì˜µì…˜**

íƒ€ì… ë ˆë²¨ì—ì„œ `optional: false`ëŠ” `posts` ê°ì²´ì˜ `author` í‚¤ë¥¼ í•„ìˆ˜ë¡œ ë§Œë“­ë‹ˆë‹¤.
íŠ¹ì • ì—”í‹°í‹°ê°€ í•­ìƒ ì¡´ì¬í•  ê²ƒì´ í™•ì‹¤í•  ë•Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

<Callout title="âŒ v1">
v1ì—ì„œëŠ” ì§€ì›ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
</Callout>

<Callout title='âœ… v2'>
```ts {9}
import { defineRelations } from "drizzle-orm";
import * as schema from "./schema";

export const relations = defineRelations(schema, (r) => ({
  users: {
    posts: r.many.posts({
      from: r.users.id,
      to: r.posts.authorId,
      optional: false,
    }),
  },
}));
```
</Callout>

**`drizzle()`ì— ëª¨ë“œ ì§€ì • ë¶ˆí•„ìš”**

ëª¨ë“  MySQL dialectì— ëŒ€í•´ ë™ì¼í•œ ì „ëµì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì°¾ì•˜ìœ¼ë¯€ë¡œ, ë” ì´ìƒ ì§€ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤

<Callout title="âŒ v1">
```ts
import * as schema from './schema'

const db = drizzle(process.env.DATABASE_URL, { mode: "planetscale", schema });
// or
const db = drizzle(process.env.DATABASE_URL, { mode: "default", schema });
```
</Callout>

<Callout title='âœ… v2'>
```ts
import { relations } from './relations'

const db = drizzle(process.env.DATABASE_URL, { relations });
```
</Callout>

**`from`ê³¼ `to` ê°œì„ **

`fields`ë¥¼ `from`ìœ¼ë¡œ, `references`ë¥¼ `to`ë¡œ ì´ë¦„ì„ ë³€ê²½í–ˆìœ¼ë©°, ë‘˜ ë‹¤ ë‹¨ì¼ ê°’ ë˜ëŠ” ë°°ì—´ì„ í—ˆìš©í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤

<Callout title="âŒ v1">
```ts
...
author: one(users, {
  fields: [posts.authorId],
  references: [users.id],
}),
...
```
</Callout>

<Callout title='âœ… v2'>
```ts
... 
author: r.one.users({
  from: r.posts.authorId,
  to: r.users.id,
}),
...
```
```ts
... 
author: r.one.users({
  from: [r.posts.authorId],
  to: [r.users.id],
}),
...
```
</Callout>

**`relationName` -> `alias`**

<Callout title="âŒ v1">
```ts
import { relations } from "drizzle-orm/_relations";
import { users, posts } from './schema';

export const postsRelation = relations(posts, ({ one }) => ({
  author: one(users, {
    fields: [posts.authorId],
    references: [users.id],
	  relationName: "author_post",
  }),
}));
```
</Callout>

<Callout title='âœ… v2'>
```ts
import { defineRelations } from "drizzle-orm";
import * as schema from "./schema";

export const relations = defineRelations(schema, (r) => ({
  posts: {
    author: r.one.users({
      from: r.posts.authorId,
      to: r.users.id,
      alias: "author_post",
    }),
  },
}));
```
</Callout>

**`custom types`ì˜ ìƒˆë¡œìš´ í•¨ìˆ˜**

Relational Queries v2ì—ì„œ ë°ì´í„° ë§¤í•‘ ë°©ì‹ì„ ì œì–´í•  ìˆ˜ ìˆë„ë¡ custom typesì— ëª‡ ê°€ì§€ ìƒˆë¡œìš´ í•¨ìˆ˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:

<Callout collapsed='fromJson'>
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ JSONìœ¼ë¡œ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì„ íƒì  ë§¤í•‘ í•¨ìˆ˜ì…ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, [RQB](https://orm.drizzle.team/docs/rqb-v2) ë˜ëŠ” [JSON functions](https://orm.drizzle.team/docs/json-functions)ë¥¼ í†µí•´ bigint ì»¬ëŸ¼ì„ ì¿¼ë¦¬í•  ë•Œ, ì¼ë°˜ ì¿¼ë¦¬ì˜ bigintì™€ ë‹¬ë¦¬ ê²°ê³¼ í•„ë“œê°€ ë¬¸ìì—´ í‘œí˜„ìœ¼ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.
ì´ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ í•´ë‹¹ í•„ë“œì˜ ë§¤í•‘ì„ ì²˜ë¦¬í•˜ëŠ” ë³„ë„ì˜ í•¨ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤:
```ts
fromJson(value: string): bigint {
	return BigInt(value);
},
```
ë°˜í™˜ë˜ëŠ” ë°ì´í„°ê°€ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½ë©ë‹ˆë‹¤:
```ts
{
	customField: "5044565289845416380";
}
```
ì—ì„œ:
```ts
{
	customField: 5044565289845416380n;
}
```
</Callout>
<Callout collapsed='forJsonSelect'>
[JSON functions](https://orm.drizzle.team/docs/json-functions) ë‚´ì—ì„œ ì»¬ëŸ¼ ì„ íƒì„ ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì„ íƒì  ì„ íƒ ìˆ˜ì •ì í•¨ìˆ˜ì…ë‹ˆë‹¤.
ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì— í•„ìš”í•  ìˆ˜ ìˆëŠ” ì¶”ê°€ ë§¤í•‘ì€ fromJson í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
[relational queries](https://orm.drizzle.team/docs/rqb-v2)ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, bigintë¥¼ ì‚¬ìš©í•  ë•Œ ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¡´í•˜ê¸° ìœ„í•´ í•„ë“œë¥¼ textë¡œ ìºìŠ¤íŒ…í•´ì•¼ í•©ë‹ˆë‹¤
```ts
forJsonSelect(identifier: SQL, sql: SQLGenerator, arrayDimensions?: number): SQL {
	return sql`${identifier}::text`
},
```
ì¿¼ë¦¬ê°€ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½ë©ë‹ˆë‹¤:
```sql
SELECT
	row_to_json("t".*)
	FROM
	(
		SELECT
		"table"."custom_bigint" AS "bigint"
		FROM
		"table"
	) AS "t"
```
ì—ì„œ:
```sql
SELECT
	row_to_json("t".*)
	FROM
	(
		SELECT
		"table"."custom_bigint"::text AS "bigint"
		FROM
		"table"
	) AS "t"
```
ì¿¼ë¦¬ë¡œ ë°˜í™˜ë˜ëŠ” ê°ì²´ê°€ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½ë©ë‹ˆë‹¤:
```ts
{
	bigint: 5044565289845416000; // JSON í˜•ì‹ìœ¼ë¡œ ì§ì ‘ ë³€í™˜í•˜ì—¬ ë¶€ë¶„ì ì¸ ë°ì´í„° ì†ì‹¤ ë°œìƒ
}
```
ì—ì„œ:
```ts
{
	bigint: "5044565289845416380"; // JSON ë³€í™˜ ì „ì— í•„ë“œë¥¼ textë¡œ ë³€í™˜í•˜ì—¬ ë°ì´í„° ë³´ì¡´
}
```
</Callout>

<Callout title='âœ… v2'>
```ts
const customBytes = customType<{
 	data: Buffer;
 	driverData: Buffer;
 	jsonData: string;
 }>({
 	dataType: () => 'bytea',
 	fromJson: (value) => {
 		return Buffer.from(value.slice(2, value.length), 'hex');
 	},
 	forJsonSelect: (identifier, sql, arrayDimensions) =>
 		sql`${identifier}::text${sql.raw('[]'.repeat(arrayDimensions ?? 0))}`,
 });
```

</Callout>

##### ìƒˆë¡œìš´ ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?

**ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ìœ„í•œ `through`**

ì´ì „ì—ëŠ” junction í…Œì´ë¸”ì„ í†µí•´ ì¿¼ë¦¬í•œ ë‹¤ìŒ ëª¨ë“  ì‘ë‹µì— ëŒ€í•´ ë§¤í•‘í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ì´ì œëŠ” ê·¸ëŸ´ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤!

<Callout collapsed='ìŠ¤í‚¤ë§ˆ'>
```ts
import * as p from "drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.integer().primaryKey(),
  name: p.text(),
  verified: p.boolean().notNull(),
});

export const groups = p.pgTable("groups", {
  id: p.integer().primaryKey(),
  name: p.text(),
});

export const usersToGroups = p.pgTable(
  "users_to_groups",
  {
    userId: p
      .integer("user_id")
      .notNull()
      .references(() => users.id),
    groupId: p
      .integer("group_id")
      .notNull()
      .references(() => groups.id),
  },
  (t) => [p.primaryKey({ columns: [t.userId, t.groupId] })]
);
```
</Callout>

<Callout title="âŒ v1">
```ts
export const usersRelations = relations(users, ({ many }) => ({
  usersToGroups: many(usersToGroups),
}));

export const groupsRelations = relations(groups, ({ many }) => ({
  usersToGroups: many(usersToGroups),
}));

export const usersToGroupsRelations = relations(usersToGroups, ({ one }) => ({
  group: one(groups, {
    fields: [usersToGroups.groupId],
    references: [groups.id],
  }),
  user: one(users, {
    fields: [usersToGroups.userId],
    references: [users.id],
  }),
}));
```
```ts
// Query example
const response = await db.query.users.findMany({
  with: {
    usersToGroups: {
      columns: {},
      with: {
        group: true,
      },
    },
  },
});
```
</Callout>

<Callout title='âœ… v2'>
```ts
import * as schema from './schema';
import { defineRelations } from 'drizzle-orm';

export const relations = defineRelations(schema, (r) => ({
  users: {
    groups: r.many.groups({
      from: r.users.id.through(r.usersToGroups.userId),
      to: r.groups.id.through(r.usersToGroups.groupId),
    }),
  },
  groups: {
    participants: r.many.users(),
  },
}));
```
```ts
// Query example
const response = await db.query.users.findMany({
  with: {
    groups: true,
  },
});
```
</Callout>

**ì‚¬ì „ ì •ì˜ëœ í•„í„°**

<Callout title="âŒ v1">
v1ì—ì„œëŠ” ì§€ì›ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
</Callout>

<Callout title='âœ… v2'>
```ts {10-12}
import * as schema from './schema';
import { defineRelations } from 'drizzle-orm';

export const relations = defineRelations(schema,
  (r) => ({
    groups: {
      verifiedUsers: r.many.users({
        from: r.groups.id.through(r.usersToGroups.groupId),
        to: r.users.id.through(r.usersToGroups.userId),
        where: {
          verified: true,
        },
      }),
    },
  })
);
```
```ts {4}
// ì¿¼ë¦¬ ì˜ˆì œ: ì¸ì¦ëœ ëª¨ë“  ì‚¬ìš©ìê°€ ìˆëŠ” ê·¸ë£¹ ê°€ì ¸ì˜¤ê¸°
const response = await db.query.groups.findMany({
  with: {
    verifiedUsers: true,
  },
});
```
</Callout>

##### `where`ê°€ ì´ì œ ê°ì²´ì…ë‹ˆë‹¤

<Callout title="âŒ v1">
```ts
const response = db._query.users.findMany({
  where: (users, { eq }) => eq(users.id, 1),
});
```
</Callout>

<Callout title="âœ… v2">
```ts
const response = db.query.users.findMany({
  where: {
    id: 1,
  },
});
```

ì „ì²´ API ë ˆí¼ëŸ°ìŠ¤ëŠ” [Select Filters ë¬¸ì„œ](/docs/rqb-v2#select-filters)ë¥¼ í™•ì¸í•˜ì„¸ìš”.
</Callout>

<Callout collapsed='RAWë¥¼ ì‚¬ìš©í•œ ë³µì¡í•œ í•„í„° ì˜ˆì œ'>
```ts
// schema.ts
import { integer, jsonb, pgTable, text, timestamp } from "drizzle-orm/pg-core";

export const users = pgTable("users", {
  id: integer("id").primaryKey(),
  name: text("name"),
  email: text("email").notNull(),
  age: integer("age"),
  createdAt: timestamp("created_at").defaultNow(),
  lastLogin: timestamp("last_login"),
  subscriptionEnd: timestamp("subscription_end"),
  lastActivity: timestamp("last_activity"),
  preferences: jsonb("preferences"),      // JSON column for user settings/preferences
  interests: text("interests").array(),     // Array column for user interests
});
```
```ts
const response = db.query.users.findMany({
  where: {
    AND: [
      {
        OR: [
          { RAW: (table) => sql`LOWER(${table.name}) LIKE 'john%'` },
          { name: { ilike: "jane%" } },
        ],
      },
      {
        OR: [
          { RAW: (table) => sql`${table.preferences}->>'theme' = 'dark'` },
          { RAW: (table) => sql`${table.preferences}->>'theme' IS NULL` },
        ],
      },
      { RAW: (table) => sql`${table.age} BETWEEN 25 AND 35` },
    ],
  },
});
```
</Callout>

##### `orderBy`ê°€ ì´ì œ ê°ì²´ì…ë‹ˆë‹¤

<Callout title="âŒ v1">
```ts
const response = db._query.users.findMany({
  orderBy: (users, { asc }) => [asc(users.id)],
});
```
</Callout>

<Callout title="âœ… v2">
```ts
const response = db.query.users.findMany({
  orderBy: { id: "asc" },
});
```
</Callout>

##### ê´€ê³„ë¡œ í•„í„°ë§í•˜ê¸°

<Callout title="âŒ v1">
v1ì—ì„œëŠ” ì§€ì›ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
</Callout>

<Callout title='âœ… v2'>
ì˜ˆì œ: IDê°€ 10ë³´ë‹¤ í¬ê³  "M"ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì½˜í…ì¸ ê°€ ìˆëŠ” ê²Œì‹œë¬¼ì„ í•˜ë‚˜ ì´ìƒ ê°€ì§„ ëª¨ë“  ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸°

```ts
const usersWithPosts = await db.query.usersTable.findMany({
  where: {
    id: {
      gt: 10
    },
    posts: {
      content: {
        like: 'M%'
      }
    }
  },
});
```
</Callout>

##### ê´€ë ¨ ê°ì²´ì—ì„œ offset ì‚¬ìš©í•˜ê¸°

<Callout title="âŒ v1">
v1ì—ì„œëŠ” ì§€ì›ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
</Callout>

<Callout title='âœ… v2'>
```ts
await db.query.posts.findMany({
	limit: 5,
	offset: 2, // correct âœ…
	with: {
		comments: {
			offset: 3, // correct âœ…
			limit: 3,
		},
	},
});
```
</Callout>

#### v1ì—ì„œ v2ë¡œ ê´€ê³„ ìŠ¤í‚¤ë§ˆ ì •ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸°

##### **ì˜µì…˜ 1**: `drizzle-kit pull` ì‚¬ìš©í•˜ê¸°

ìƒˆ ë²„ì „ì˜ `drizzle-kit pull`ì€ ìƒˆë¡œìš´ êµ¬ë¬¸ìœ¼ë¡œ `relations.ts` íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ì§€ì›í•©ë‹ˆë‹¤:

##### 1ë‹¨ê³„

<Npx>
drizzle-kit pull
</Npx>

#### 2ë‹¨ê³„

ìƒì„±ëœ ê´€ê³„ ì½”ë“œë¥¼ `drizzle/relations.ts`ì—ì„œ ê´€ê³„ë¥¼ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” íŒŒì¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤ 
```plaintext {4-5}
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ meta
 â”‚ â”œ ğŸ“œ migration.sql
 â”‚ â”œ ğŸ“œ relations.ts â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ â”” ğŸ“œ schema.ts            |
 â”œ ğŸ“‚ src                    â”‚ 
 â”‚ â”œ ğŸ“‚ db                   â”‚
 â”‚ â”‚ â”œ ğŸ“œ relations.ts <â”€â”€â”€â”€â”€â”˜
 â”‚ â”‚ â”” ğŸ“œ schema.ts 
 â”‚ â”” ğŸ“œ index.ts         
 â”” â€¦
```

<Callout>
`drizzle/relations.ts`ëŠ” `drizzle/schema.ts`ì—ì„œ ëª¨ë“  í…Œì´ë¸”ì˜ importë¥¼ í¬í•¨í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:
```ts
import * as schema from './schema'
```

ëª¨ë“  ìŠ¤í‚¤ë§ˆ í…Œì´ë¸”ì´ ìˆëŠ” íŒŒì¼ë¡œ ì´ importë¥¼ ë³€ê²½í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ëŸ¬ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì´ ìˆëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```ts
import * as schema1 from './schema1'
import * as schema2 from './schema2'
...
```
</Callout>

#### 3ë‹¨ê³„

drizzle ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ì„ ë³€ê²½í•˜ê³  `schema` ëŒ€ì‹  `relations` ê°ì²´ë¥¼ ì œê³µí•©ë‹ˆë‹¤

<Callout title='ì´ì „'>
```ts
import * as schema from './schema'
import { drizzle } from 'drizzle-orm/...'

const db = drizzle('<url>', { schema })
```
</Callout>

<Callout title='ì´í›„'>
```ts
// 2ë‹¨ê³„ì˜ íŒŒì¼ì—ì„œ importí•´ì•¼ í•©ë‹ˆë‹¤
import { relations } from './relations'
import { drizzle } from 'drizzle-orm/...'

const db = drizzle('<url>', { relations })
```
</Callout>

<Callout>
MySQL dialectë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´ ë²„ì „ 2ì—ì„œëŠ” í•„ìš”í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ `drizzle()`ì—ì„œ `mode`ë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
</Callout>


##### ìˆ˜ë™ ë§ˆì´ê·¸ë ˆì´ì…˜

ìˆ˜ë™ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë ¤ë©´ ì¼ëŒ€ì¼, ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ë‹¤ ê´€ê³„ì˜ ì™„ì „í•œ API ë ˆí¼ëŸ°ìŠ¤ì™€ ì˜ˆì œë¥¼ ë³´ë ¤ë©´ [Drizzle Relations ì„¹ì…˜](/docs/relations-v2)ì„ í™•ì¸í•˜ì„¸ìš”.

#### v1ì—ì„œ v2ë¡œ ì¿¼ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê¸°

##### `where` ë¬¸ ë§ˆì´ê·¸ë ˆì´ì…˜

ì˜ˆì œì™€ ì™„ì „í•œ API ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë³´ë ¤ë©´ [Select Filters ë¬¸ì„œ](/docs/rqb-v2#select-filters)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

ìƒˆë¡œìš´ êµ¬ë¬¸ìœ¼ë¡œ `AND`, `OR`, `NOT`, `RAW`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°,
Relations v1ì—ì„œ ì´ì „ì— ì‚¬ìš© ê°€ëŠ¥í–ˆë˜ ëª¨ë“  í•„í„°ë§ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì˜ˆì œ**
<CodeTabs items={["simple eq", "using AND", "using OR", "using NOT", "complex example using RAW"]}>
<CodeTab>
```ts
const response = db.query.users.findMany({
  where: {
    age: 15,
  },
});
```
```sql {3}
select "users"."id" as "id", "users"."name" as "name"
from "users" 
where ("users"."age" = $1)
```
</CodeTab>
<CodeTab>
```ts
const response = db.query.users.findMany({
  where: {
    age: 15,
    name: 'John'
  },
});
```
```sql {3}
select "users"."id" as "id", "users"."name" as "name"
from "users" 
where ("users"."age" = $1 and "users"."name" = $2)
```
</CodeTab>
<CodeTab>
```ts
const response = await db.query.users.findMany({
  where: {
    OR: [
      {
        id: {
          gt: 10,
        },
      },
	  {
		name: {
          like: "John%",
        },
	  }
    ],
  },
});
```
```sql {3}
select "users"."id" as "id", "users"."name" as "name" 
from "users" 
where ("users"."id" > $1 or "users"."name" like $2)
```
</CodeTab>
<CodeTab>
```ts
const response = db.query.users.findMany({
  where: {
    NOT: {
      id: {
        gt: 10,
      },
    },
    name: {
      like: "John%",
    },
  },
});
```
```sql {3}
select "users"."id" as "id", "users"."name" as "name" 
from "users" 
where (not "users"."id" > $1 and "users"."name" like $2)
```
</CodeTab>
<CodeTab>
```ts
// schema.ts
import { integer, jsonb, pgTable, text, timestamp } from "drizzle-orm/pg-core";

export const users = pgTable("users", {
  id: integer("id").primaryKey(),
  name: text("name"),
  email: text("email").notNull(),
  age: integer("age"),
  createdAt: timestamp("created_at").defaultNow(),
  lastLogin: timestamp("last_login"),
  subscriptionEnd: timestamp("subscription_end"),
  lastActivity: timestamp("last_activity"),
  preferences: jsonb("preferences"),      // JSON column for user settings/preferences
  interests: text("interests").array(),     // Array column for user interests
});
```
```ts
const response = db.query.users.findMany({
  where: {
    AND: [
      {
        OR: [
          { RAW: (table) => sql`LOWER(${table.name}) LIKE 'john%'` },
          { name: { ilike: "jane%" } },
        ],
      },
      {
        OR: [
          { RAW: (table) => sql`${table.preferences}->>'theme' = 'dark'` },
          { RAW: (table) => sql`${table.preferences}->>'theme' IS NULL` },
        ],
      },
      { RAW: (table) => sql`${table.age} BETWEEN 25 AND 35` },
    ],
  },
});
```
```sql
```
</CodeTab>
</CodeTabs>

##### `orderBy` ë¬¸ ë§ˆì´ê·¸ë ˆì´ì…˜

Order byëŠ” ì»¬ëŸ¼ê³¼ ì •ë ¬ ë°©í–¥(`asc` ë˜ëŠ” `desc`)ì„ ì§€ì •í•˜ëŠ” ë‹¨ì¼ ê°ì²´ë¡œ ë‹¨ìˆœí™”ë˜ì—ˆìŠµë‹ˆë‹¤

<Callout title="âŒ v1">
```ts
const response = db._query.users.findMany({
  orderBy: (users, { asc }) => [asc(users.id)],
});
```
</Callout>

<Callout title="âœ… v2">
```ts
const response = db.query.users.findMany({
  orderBy: { id: "asc" },
});
```
</Callout>

##### `ë‹¤ëŒ€ë‹¤` ì¿¼ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜

Relational Queries v1ì€ ë‹¤ëŒ€ë‹¤ ì¿¼ë¦¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ë§¤ìš° ë³µì¡í•œ ë°©ë²•ì„ ê°€ì§€ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
junction í…Œì´ë¸”ì„ í†µí•´ ëª…ì‹œì ìœ¼ë¡œ ì¿¼ë¦¬í•œ ë‹¤ìŒ í•´ë‹¹ í…Œì´ë¸”ì„ ë§¤í•‘í•´ì•¼ í–ˆìŠµë‹ˆë‹¤:

```ts
const response = await db.query.users.findMany({
  with: {
    usersToGroups: {
      columns: {},
      with: {
        group: true,
      },
    },
  },
});
```

Relational Queries v2ë¡œ ì—…ê·¸ë ˆì´ë“œí•œ í›„ ë‹¤ëŒ€ë‹¤ ê´€ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:

```ts
import * as schema from './schema';
import { defineRelations } from 'drizzle-orm';

export const relations = defineRelations(schema, (r) => ({
  users: {
    groups: r.many.groups({
      from: r.users.id.through(r.usersToGroups.userId),
      to: r.groups.id.through(r.usersToGroups.groupId),
    }),
  },
  groups: {
    participants: r.many.users(),
  },
}));
```

ì¿¼ë¦¬ë¥¼ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë©ë‹ˆë‹¤:

```ts
// ì¿¼ë¦¬ ì˜ˆì œ
const response = await db.query.users.findMany({
  with: {
    groups: true,
  },
});
```

#### ë¶€ë¶„ ì—…ê·¸ë ˆì´ë“œ ë˜ëŠ” ì—…ê·¸ë ˆì´ë“œ í›„ì—ë„ RQB v1 ìœ ì§€í•˜ê¸°

ëª¨ë“  ì´ì „ ì¿¼ë¦¬ì™€ ê´€ê³„ ì •ì˜ê°€ ì—¬ì „íˆ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì—…ê·¸ë ˆì´ë“œë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ ì—†ì´ ì¿¼ë¦¬ë³„ë¡œ ì½”ë“œë² ì´ìŠ¤ë¥¼ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

##### 1ë‹¨ê³„: ê´€ê³„ import ë³€ê²½

Relational Queries v1ì„ ì‚¬ìš©í•˜ì—¬ ê´€ê³„ë¥¼ ì •ì˜í•˜ë ¤ë©´ `drizzle-orm`ì—ì„œ importí•´ì•¼ í•©ë‹ˆë‹¤

<Callout type='error' title='v1'>
```ts
import { relations } from 'drizzle-orm';
```
</Callout>

Relational Queries v2ì—ì„œëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•œ ì‹œê°„ì„ ì£¼ê¸° ìœ„í•´ `drizzle-orm/_relations`ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤

<Callout title='v2'>
```ts
import { relations } from "drizzle-orm/_relations";
```
</Callout>

##### 2ë‹¨ê³„: ì¿¼ë¦¬ë¥¼ `._query`ë¡œ êµì²´

Relational Queries v1ì„ ì‚¬ìš©í•˜ë ¤ë©´ `db.query.`ë¥¼ ì‘ì„±í•´ì•¼ í–ˆìŠµë‹ˆë‹¤

<Callout type='error' title='v1'>
```ts
await db.query.users.findMany();
```
</Callout>

Relational Queries v2ì—ì„œëŠ” `db.query`ë¥¼ ìƒˆë¡œìš´ êµ¬ë¬¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ `db._query`ë¡œ ì´ë™í–ˆìœ¼ë©°,
ì—¬ì „íˆ `db._query`ë¥¼ í†µí•´ ì´ì „ êµ¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

`db.query`ë¥¼ ë‹¨ìˆœíˆ ì§€ì› ì¤‘ë‹¨í•˜ê³  `db.query2` ë˜ëŠ” `db.queryV2`ì™€ ê°™ì€ ê²ƒìœ¼ë¡œ êµì²´í•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•´
ì˜¤ëœ ë…¼ì˜ë¥¼ í–ˆìŠµë‹ˆë‹¤. ê²°êµ­ ëª¨ë“  ìƒˆë¡œìš´ APIëŠ” `db.query`ì²˜ëŸ¼ ê°„ë‹¨í•˜ê²Œ ìœ ì§€ë˜ì–´ì•¼ í•˜ë©°,
ì´ì „ êµ¬ë¬¸ì„ ê³„ì† ì‚¬ìš©í•˜ë ¤ë©´ ëª¨ë“  ì¿¼ë¦¬ë¥¼ `db._query`ë¡œ êµì²´í•˜ë„ë¡ ìš”êµ¬í•˜ëŠ” ê²ƒì´
í–¥í›„ ëª¨ë“  ì‚¬ëŒì´ `db.queryV2`, `db.queryV3`, `db.queryV4` ë“±ì„ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí•˜ëŠ” ê²ƒë³´ë‹¤
ë‚«ë‹¤ê³  ê²°ì •í–ˆìŠµë‹ˆë‹¤.

<Callout title='v2'>
```ts
// RQBv1 ì‚¬ìš©
await db._query.users.findMany();

// RQBv2 ì‚¬ìš©
await db.query.users.findMany();
```
</Callout>

##### 3ë‹¨ê³„

[ì´ ê°€ì´ë“œ](#how-to-migrate-relations-schema-definition-from-v1-to-v2)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ê´€ê³„ë¥¼ ì •ì˜í•˜ê±°ë‚˜ ê°€ì ¸ì˜¨ ë‹¤ìŒ,
ìƒˆ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•˜ê±°ë‚˜ ê¸°ì¡´ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì”© ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ì„¸ìš”.


### ë‚´ë¶€ ë³€ê²½ì‚¬í•­

1. ëª¨ë“  `drizzle` database, `session`, `migrator`, `transaction` ì¸ìŠ¤í„´ìŠ¤ê°€ RQB v2 ì¿¼ë¦¬ë¥¼ ìœ„í•œ 2ê°œì˜ ì¶”ê°€ ì œë„¤ë¦­ ì¸ìë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤

<Callout collapsed='ì˜ˆì œ'>
**migrator**
<Callout type='error' title='ì´ì „'>
```ts
export async function migrate<
  TSchema extends Record<string, unknown>
>(
  db: NodePgDatabase<TSchema>,
  config: MigrationConfig,
) {
  ...
}
```
</Callout>
<Callout title='ì´í›„'>
```ts {3,5}
export async function migrate<
 TSchema extends Record<string, unknown>,
 TRelations extends AnyRelations
>(
  db: NodePgDatabase<TSchema, TRelations>,
  config: MigrationConfig,
) {
  ...
}
```
</Callout>
**session**
<Callout type='error' title='ì´ì „'>
```ts
export class NodePgSession<
  TFullSchema extends Record<string, unknown>,
  TSchema extends V1.TablesRelationalConfig,
> extends PgSession<NodePgQueryResultHKT, TFullSchema, TSchema>
```
</Callout>
<Callout title='ì´í›„'>
```ts {3,4,6}
export class NodePgSession<
  TFullSchema extends Record<string, unknown>,
  TRelations extends AnyRelations,
  TTablesConfig extends TablesRelationalConfig,
  TSchema extends V1.TablesRelationalConfig,
> extends PgSession<NodePgQueryResultHKT, TFullSchema, TRelations, TTablesConfig, TSchema>
```
</Callout>
**transaction**
<Callout type='error' title='ì´ì „'>
```ts
export class NodePgTransaction<
  TFullSchema extends Record<string, unknown>,
  TSchema extends V1.TablesRelationalConfig,
> extends PgTransaction<NodePgQueryResultHKT, TFullSchema, TSchema>
```
</Callout>
<Callout title='ì´í›„'>
```ts {3,4,6}
export class NodePgTransaction<
  TFullSchema extends Record<string, unknown>,
  TRelations extends AnyRelations,
  TTablesConfig extends TablesRelationalConfig,
  TSchema extends V1.TablesRelationalConfig,
> extends PgTransaction<NodePgQueryResultHKT, TFullSchema, TRelations, TTablesConfig, TSchema>
```
</Callout>
**driver**
<Callout type='error' title='ì´ì „'>
```ts
export class NodePgDatabase<
  TSchema extends Record<string, unknown> = Record<string, never>,
> extends PgDatabase<NodePgQueryResultHKT, TSchema>
```
</Callout>
<Callout title='ì´í›„'>
```ts {3,4}
export class NodePgDatabase<
  TSchema extends Record<string, unknown> = Record<string, never>,
  TRelations extends AnyRelations = EmptyRelations,
> extends PgDatabase<NodePgQueryResultHKT, TSchema, TRelations>
```
</Callout>
</Callout>

2. `DrizzleConfig` ì œë„¤ë¦­ì— `TRelations` ì¸ìì™€ `relations: TRelations` í•„ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤

<Callout collapsed='ì˜ˆì œ'>
<Callout type='error' title='ì´ì „'>
```ts
export interface DrizzleConfig<
  TSchema extends Record<string, unknown> = Record<string, never>
> {
  logger?: boolean | Logger;
  schema?: TSchema;
  casing?: Casing;
}
```
</Callout>

<Callout title='ì´í›„'>
```ts {8}
export interface DrizzleConfig<
  TSchema extends Record<string, unknown> = Record<string, never>,
  TRelations extends AnyRelations = EmptyRelations,
> {
  logger?: boolean | Logger;
  schema?: TSchema;
  casing?: Casing;
  relations?: TRelations;
}
```
</Callout>
</Callout>

3. ë‹¤ìŒ ì—”í‹°í‹°ë“¤ì´ `drizzle-orm` ë° `drizzle-orm/relations`ì—ì„œ `drizzle-orm/_relations`ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤. ì›ë³¸ importëŠ” ì´ì œ
Relational Queries v2ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìƒˆë¡œìš´ íƒ€ì…ì„ í¬í•¨í•˜ë¯€ë¡œ, ì´ì „ íƒ€ì…ì„ ì‚¬ìš©í•˜ë ¤ë©´ importë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤:

<Callout collapsed='ì´ë™ëœ ëª¨ë“  ì—”í‹°í‹° ëª©ë¡'>
- `Relation`
- `Relations`
- `One`
- `Many`
- `TableRelationsKeysOnly`
- `ExtractTableRelationsFromSchema`
- `ExtractObjectValues`
- `ExtractRelationsFromTableExtraConfigSchema`
- `getOperators`
- `Operators`
- `getOrderByOperators`
- `OrderByOperators`
- `FindTableByDBName`
- `DBQueryConfig`
- `TableRelationalConfig`
- `TablesRelationalConfig`
- `RelationalSchemaConfig`
- `ExtractTablesWithRelations`
- `ReturnTypeOrValue`
- `BuildRelationResult`
- `NonUndefinedKeysOnly`
- `BuildQueryResult`
- `RelationConfig`
- `extractTablesRelationalConfig`
- `relations`
- `createOne`
- `createMany`
- `NormalizedRelation`
- `normalizeRelation`
- `createTableRelationsHelpers`
- `TableRelationsHelpers`
- `BuildRelationalQueryResult`
- `mapRelationalRow`
</Callout>

4. ë§ˆì°¬ê°€ì§€ë¡œ `${dialect}-core/query-builders/query` íŒŒì¼ì´ `${dialect}-core/query-builders/_query`ë¡œ ì´ë™ë˜ì—ˆìœ¼ë©°
RQB v2ì˜ ëŒ€ì•ˆì´ ê·¸ ìë¦¬ì— ë°°ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤

<Callout collapsed='ì˜ˆì œ'>
<Callout type='error' title='ì´ì „'>
```ts
import { RelationalQueryBuilder, PgRelationalQuery } from './query-builders/query.ts';
```
</Callout>

<Callout title='ì´í›„'>
```ts
import { _RelationalQueryBuilder, _PgRelationalQuery } from './query-builders/_query.ts';
```
</Callout>
</Callout>
